{% extends 'Painting/base.html' %}
{% load static %}
{% block content %}
    <h1>
        {% if not mps_empty %}
            {{ date|date:'Y-m-d' }}喷漆生产合格率:
        {% else %}
            {{ date|date:'Y-m-d' }}<span style="color: #FF0000">无</span>生产计划
        {% endif %}
        &emsp;
        <a href="{% url 'Painting:painting_fpy_day_view' prev_day|date:'Y-m-d' %}" class="btn btn-outline-info">前一天</a>
        <a href="{% url 'Painting:painting_fpy_day_view' next_day|date:'Y-m-d' %}" class="btn btn-outline-info">后一天</a>
        <a href="{% url 'Painting:monthly' date|date:'Y-m' %}" class="btn btn-outline-info">按月查看</a>

    </h1>
    <div>
        <h1>总产量:{{ sum_records_all }}</h1>
        <h1>合格量:{{ sum_records_qualified }}</h1>
    </div>
    <div class="container float-left">
        <div class="row" id="echarts" style="width: 1000px;height:300px;" ></div>
        <div>
            <table class="table table-striped table-bordered table-hover" id="table"></table>
        </div>
    </div>
    <script>
        // json数据解包
        let data = {{ echarts_elements|safe }};
        x_axis = data.x_axis;
        y_axis = data.y_axis;
        day_fpy = data.day_fpy;
        console.log(y_axis);
        // 基于准备好的dom，初始化echarts实例
        var myChart = echarts.init(document.getElementById('echarts'));
        // 指定图表的配置项和数据
        var option = {
            tooltip : {
                    trigger: 'axis',
                    axisPointer : {            // 坐标轴指示器，坐标轴触发有效
                        type : 'shadow'        // 默认为直线，可选为：'line' | 'shadow'
                    }
                },
            legend: {
                x:'100px',
                y:'30px',
                data:['小时合格率']
            },
            grid: {
                left: '3%',
                right: '4%',
                bottom: '3%',
                containLabel: true
            },
            toolbox: {
                x:'800px',
                y:'30px',
                feature: {
                    dataZoom: {
                        yAxisIndex: 'none'
                    },
                    magicType: {type: ['line', 'bar']},
                    restore: {},
                    saveAsImage: {}
                }
            },
            xAxis: {
                // x轴文字倾斜
                axisLabel: {
                    interval: 0,
                    rotate: 45,//倾斜度 -90 至 90 默认为0
                    margin: 2,
                    textStyle: {
                        fontWeight: "bolder",
                        color: "#000000"
                    }
                },
                type: 'category',
                data: x_axis,
                axisTick: {
                    alignWithLabel: true,
                    show: false
                }
            },
            yAxis : [
                {
                    type : 'value'
                }
            ],
            series : [
                {
                    name: '小时合格率',
                    type: 'bar',
                    data: y_axis,
                    color: '#50bae3',
                    markLine : {
                        symbol: 'none',
                        label:{
                            show: true,
                            position: 'middle',
                            formatter: '{b}'
                        },
                        lineStyle: {
                            width: 3,
                            color: '#EFD914',
                            type: 'solid'
                        },
                        data: [
                            {
                                name: '日合格率:' + day_fpy,
                                yAxis: day_fpy
                            }
                        ]
                    }
                },
            ]
        };
        // 使用刚指定的配置项和数据显示图表。
        myChart.setOption(option);
        //*************************************************************//
        //*************************************************************//
        // 设置bootstrap-table数据
        var tableColumns = [
            {field: 'hour', title: '第几小时', sortable: true},
            {field: 'hourly_output_qualified', title: '每小时合格量', sortable: true},
            {field: 'hourly_output', title: '每小时总产量', sortable: true}
        ];
        var test_data = [
            {actual_outputs:123,input_datetime:20200320}
        ];
        $('#table').bootstrapTable('destroy'); //动态加载表格之前，先销毁表格
        $('#table').bootstrapTable({//表格初始化
            columns: tableColumns,  //表头
            data:{{ bootstrap_table_data|safe }},
            width:300,  //表格宽度
            // height:1268,  //表格高度,如果没有设置height属性，表格自动根据记录条数觉得表格高度
            method: 'get',  //请求方式
            pageSize: 10,  //每页的记录数
            pageNumber: 1,  //初始化加载第一页（默认显示第一页）
            pageList: [10, 25, 50, 100, 'All'],  //可供选择的每页的行数
            smartDisplay:false,  //加上这句，否则pageList中的'All'失效
            cache: false,  //是否使用缓存，默认为true，所以一般情况下需要设置一下这个属性
            striped: true,  //是否显示行间隔色
            pagination: true,  //是否显示分页
            sidePagination: 'client',  //分页方式：client客户端分页，server服务端分页（*）,数据为json数组时写client，json对象时（有total和rows时）这里要为server方式，写client列表无数据
            search: true,  //是否显示表格搜索，此搜索是客户端搜索，不会进服务端，所以，个人感觉意义不大
            showRefresh: false,  //是否显示刷新按钮
            showExport: false,
            showFooter: true,
            // exportTypes: ['csv', 'txt', 'xml'],
            clickToSelect: true,
        });
    </script>
{% endblock %}